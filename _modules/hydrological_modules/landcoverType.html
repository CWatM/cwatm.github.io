<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hydrological_modules.landcoverType &#8212; Community Water Model</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Community Water Model" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CWATM</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydrological_modules.landcoverType</h1><div class="highlight"><pre>
<span></span><span class="c1"># -------------------------------------------------------------------------</span>
<span class="c1"># Name:        Land Cover Type module</span>
<span class="c1"># Purpose:</span>
<span class="c1">#</span>
<span class="c1"># Author:      PB</span>
<span class="c1">#</span>
<span class="c1"># Created:     15/07/2016</span>
<span class="c1"># Copyright:   (c) PB 2016</span>
<span class="c1"># -------------------------------------------------------------------------</span>

<span class="kn">from</span> <span class="nn">management_modules.data_handling</span> <span class="k">import</span> <span class="o">*</span>


<div class="viewcode-block" id="landcoverType"><a class="viewcode-back" href="../../hydrological_modules.html#hydrological_modules.landcoverType.landcoverType">[docs]</a><span class="k">class</span> <span class="nc">landcoverType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    # ************************************************************</span>
<span class="sd">    # *****  LAND COVER TYPE *************************************</span>
<span class="sd">    # ************************************************************</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">landcoverType_variable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">landcoverType_variable</span>

<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="landcoverType.initial"><a class="viewcode-back" href="../../hydrological_modules.html#hydrological_modules.landcoverType.landcoverType.initial">[docs]</a>    <span class="k">def</span> <span class="nf">initial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; initial part of the land cover type module</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">coverTypes</span><span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">,</span> <span class="n">binding</span><span class="p">[</span><span class="s2">&quot;coverTypes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span>

        <span class="n">landcoverPara</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;minTopWaterLayer&#39;</span><span class="p">,</span><span class="s1">&#39;minCropKC&#39;</span><span class="p">,</span><span class="s1">&#39;minInterceptCap&#39;</span><span class="p">,</span><span class="s1">&#39;cropDeplFactor&#39;</span><span class="p">,</span><span class="s1">&#39;fracVegCover&#39;</span><span class="p">,</span><span class="s1">&#39;rootFraction1&#39;</span><span class="p">,</span><span class="s1">&#39;rootFraction2&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;maxRootDepth&#39;</span><span class="p">,</span> <span class="s1">&#39;minSoilDepthFrac&#39;</span><span class="p">,</span><span class="s1">&#39;maxSoilDepthFrac&#39;</span><span class="p">,</span><span class="s1">&#39;interceptStor&#39;</span><span class="p">,</span> <span class="s1">&#39;topWaterLayer&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;storUpp000005&#39;</span><span class="p">,</span> <span class="s1">&#39;storUpp005030&#39;</span><span class="p">,</span> <span class="s1">&#39;storLow030150&#39;</span><span class="p">,</span> <span class="s1">&#39;interflow&#39;</span><span class="p">,</span><span class="s1">&#39;arnoBeta&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;cropCoefficientNC_filename&#39;</span><span class="p">,</span> <span class="s1">&#39;interceptCapNC_filename&#39;</span><span class="p">,</span><span class="s1">&#39;coverFractionNC_filename&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">landcoverPara</span><span class="p">:</span>
            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># fraction of what type of irrigation area</span>
        <span class="c1"># fraction (m2) of a certain irrigation type over (only) total irrigation area ; will be assigned by the landSurface module</span>
        <span class="c1"># output variable per land cover class</span>
        <span class="n">landcoverVars</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;irrTypeFracOverIrr&#39;</span><span class="p">,</span><span class="s1">&#39;fractionArea&#39;</span><span class="p">,</span><span class="s1">&#39;totAvlWater&#39;</span><span class="p">,</span> <span class="s1">&#39;adjRootFrUpp000005&#39;</span><span class="p">,</span><span class="s1">&#39;adjRootFrUpp005030&#39;</span><span class="p">,</span> <span class="s1">&#39;adjRootFrLow030150&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;effSatAt50&#39;</span><span class="p">,</span>  <span class="s1">&#39;effPoreSizeBetaAt50&#39;</span><span class="p">,</span> <span class="s1">&#39;rootZoneWaterStorageMin&#39;</span><span class="p">,</span><span class="s1">&#39;rootZoneWaterStorageRange&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;directRunoff&#39;</span><span class="p">,</span><span class="s1">&#39;totalPotET&#39;</span><span class="p">,</span><span class="s1">&#39;potBareSoilEvap&#39;</span><span class="p">,</span><span class="s1">&#39;potTranspiration&#39;</span><span class="p">,</span><span class="s1">&#39;availWaterInfiltration&#39;</span><span class="p">,</span><span class="s1">&#39;interceptEvap&#39;</span><span class="p">,</span><span class="s1">&#39;soilWaterStorage&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;infiltration&#39;</span><span class="p">,</span><span class="s1">&#39;actBareSoilEvap&#39;</span><span class="p">,</span><span class="s1">&#39;landSurfaceRunoff&#39;</span><span class="p">,</span><span class="s1">&#39;actTranspiTotal&#39;</span><span class="p">,</span><span class="s1">&#39;netPercUpp000005&#39;</span><span class="p">,</span> <span class="s1">&#39;netPercUpp005030&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;gwRecharge&#39;</span><span class="p">,</span><span class="s1">&#39;interflow&#39;</span><span class="p">,</span><span class="s1">&#39;actualET&#39;</span><span class="p">,</span><span class="s1">&#39;interflowTotal&#39;</span><span class="p">,</span><span class="s1">&#39;percLow030150&#39;</span><span class="p">,</span><span class="s1">&#39;openWaterEvap&#39;</span><span class="p">,</span><span class="s1">&#39;capRiseLow030150&#39;</span><span class="p">,</span> <span class="s1">&#39;irrGrossDemand&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;interceptStor&#39;</span><span class="p">,</span><span class="s1">&#39;topWaterLayer&#39;</span><span class="p">,</span><span class="s1">&#39;storUpp000005&#39;</span><span class="p">,</span><span class="s1">&#39;storUpp005030&#39;</span><span class="p">,</span><span class="s1">&#39;storLow030150&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;totalPotentialGrossDemand&#39;</span><span class="p">,</span><span class="s1">&#39;actSurfaceWaterAbstract&#39;</span><span class="p">,</span><span class="s1">&#39;potGroundwaterAbstract&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">landcoverVars</span><span class="p">:</span>
             <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>

        <span class="c1"># set aggregated storages to zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">landcoverSum</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;interceptStor&#39;</span><span class="p">,</span> <span class="s1">&#39;topWaterLayer&#39;</span><span class="p">,</span><span class="s1">&#39;interflow&#39;</span><span class="p">,</span> <span class="s1">&#39;storUpp000005&#39;</span><span class="p">,</span> <span class="s1">&#39;storUpp005030&#39;</span><span class="p">,</span> <span class="s1">&#39;storLow030150&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;directRunoff&#39;</span><span class="p">,</span> <span class="s1">&#39;totalPotET&#39;</span><span class="p">,</span> <span class="s1">&#39;potBareSoilEvap&#39;</span><span class="p">,</span> <span class="s1">&#39;potTranspiration&#39;</span><span class="p">,</span> <span class="s1">&#39;availWaterInfiltration&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;interceptEvap&#39;</span><span class="p">,</span> <span class="s1">&#39;soilWaterStorage&#39;</span><span class="p">,</span> <span class="s1">&#39;infiltration&#39;</span><span class="p">,</span> <span class="s1">&#39;actBareSoilEvap&#39;</span><span class="p">,</span> <span class="s1">&#39;landSurfaceRunoff&#39;</span><span class="p">,</span> <span class="s1">&#39;actTranspiTotal&#39;</span><span class="p">,</span> <span class="s1">&#39;netPercUpp000005&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;netPercUpp005030&#39;</span><span class="p">,</span><span class="s1">&#39;gwRecharge&#39;</span><span class="p">,</span><span class="s1">&#39;actualET&#39;</span><span class="p">,</span><span class="s1">&#39;interflowTotal&#39;</span><span class="p">,</span><span class="s1">&#39;percLow030150&#39;</span><span class="p">,</span> <span class="s1">&#39;topWaterLayer&#39;</span><span class="p">,</span><span class="s1">&#39;capRiseLow030150&#39;</span><span class="p">,</span> <span class="s1">&#39;openWaterEvap&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;irrGrossDemand&#39;</span><span class="p">,</span><span class="s1">&#39;totalPotentialGrossDemand&#39;</span><span class="p">,</span><span class="s1">&#39;actSurfaceWaterAbstract&#39;</span><span class="p">,</span><span class="s1">&#39;potGroundwaterAbstract&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">landcoverSum</span><span class="p">:</span>
            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="s2">&quot;sum_&quot;</span><span class="o">+</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totalSoil</span> <span class="o">=</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totalET</span> <span class="o">=</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>


        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">coverType</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">coverTypes</span><span class="p">:</span>
            <span class="n">frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_fracVegCover&quot;</span><span class="p">),</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
            <span class="c1">#forest + grassland should be 1)</span>
            <span class="k">if</span> <span class="n">coverType</span> <span class="o">==</span> <span class="s2">&quot;grassland&quot;</span><span class="p">:</span>
                <span class="n">frac</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">frac</span><span class="p">)</span>
            <span class="c1">#self.var.fracVegCover.append(loadmap(coverType + &quot;_fracVegCover&quot;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracForestOrig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracGrasslandOrig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#  rescales natural land cover fractions (make sure the total = 1)  #TODO</span>
        <span class="c1"># forest  = 0, grassland = 1, irrPaddy = 2 , irrnonpaddy = 3</span>
        <span class="c1"># fraction of land for irrigation</span>
        <span class="n">irrigatedAreaFrac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="c1"># Correction of forest and grassland by irrigation part: #have to think if irrigation should go at the same pecentage from forest</span>
        <span class="c1"># BETTER adjust these maps before !!!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span> <span class="n">irrigatedAreaFrac</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span> <span class="n">irrigatedAreaFrac</span><span class="p">)</span>

        <span class="c1"># fraction of what type of irrigation area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrTypeFracOverIrr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">irrigatedAreaFrac</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrTypeFracOverIrr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span><span class="n">E</span><span class="o">-</span><span class="mi">9</span><span class="p">,</span><span class="n">irrigatedAreaFrac</span><span class="p">)</span>




        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">coverType</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">coverTypes</span><span class="p">:</span>
            <span class="c1"># other paramater values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">arnoBeta</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_arnoBeta&quot;</span><span class="p">))</span>
            <span class="c1"># b coefficient of soil water storage capacity distribution</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">minTopWaterLayer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_minTopWaterLayer&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">minCropKC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_minCropKC&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">minInterceptCap</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_minInterceptCap&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">cropDeplFactor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_cropDeplFactor&quot;</span><span class="p">))</span>
            <span class="c1"># parameter values</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootFraction1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_rootFraction1&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootFraction2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_rootFraction2&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">maxRootDepth</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_maxRootDepth&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">minSoilDepthFrac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_minSoilDepthFrac&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">maxSoilDepthFrac</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loadmap</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_maxSoilDepthFrac&quot;</span><span class="p">))</span>

            <span class="c1"># filenames</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">cropCoefficientNC_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_cropCoefficientNC&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">interceptCapNC_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_interceptCapNC&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">coverFractionNC_filename</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_coverFractionNC&quot;</span><span class="p">)</span>




            <span class="c1"># init values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">interceptStor</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">init_module</span><span class="o">.</span><span class="n">load_initial</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_interceptStor&quot;</span><span class="p">))</span>
            <span class="c1">#self.var.topWaterLayer.append(self.var.init_module.load_initial(coverType + &quot;_topWaterLayerIni&quot;))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">topWaterLayer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">init_module</span><span class="o">.</span><span class="n">load_initial</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_topWaterLayer&quot;</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storUpp000005</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">init_module</span><span class="o">.</span><span class="n">load_initial</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_storUpp000005&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storUpp005030</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">init_module</span><span class="o">.</span><span class="n">load_initial</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_storUpp005030&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storLow030150</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">init_module</span><span class="o">.</span><span class="n">load_initial</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_storLow030150&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">interflow</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">init_module</span><span class="o">.</span><span class="n">load_initial</span><span class="p">(</span><span class="n">coverType</span> <span class="o">+</span> <span class="s2">&quot;_interflow&quot;</span><span class="p">))</span>

            <span class="c1"># summarize the following initial storages:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">interceptStor</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">topWaterLayer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># Improved Arno&#39;s scheme parameters:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">arnoBeta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">arnoBeta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">maxSoilDepthFrac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">minSoilDepthFrac</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">orographyBeta</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">arnoBeta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">arnoBeta</span><span class="p">))</span>

            <span class="c1"># PB changed to max 1.0 #TODO</span>
            <span class="c1">#report(decompress(self.var.arnoBeta[i]), &quot;C:\work\output\harno.map&quot;)</span>



            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootZoneWaterStorageMin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">minSoilDepthFrac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootZoneWaterStorageCap</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootZoneWaterStorageRange</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootZoneWaterStorageCap</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootZoneWaterStorageMin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="c1"># scaleRootFractions</span>
            <span class="n">rootFracUpp000005</span> <span class="o">=</span> <span class="mf">0.05</span><span class="o">/</span><span class="mf">0.30</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootFraction1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">rootFracUpp005030</span> <span class="o">=</span> <span class="mf">0.25</span><span class="o">/</span><span class="mf">0.30</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootFraction1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">rootFracLow030150</span> <span class="o">=</span> <span class="mf">1.20</span><span class="o">/</span><span class="mf">1.20</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">rootFraction2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rootFracUpp000005</span> <span class="o">/</span> <span class="p">(</span><span class="n">rootFracUpp000005</span> <span class="o">+</span> <span class="n">rootFracUpp005030</span> <span class="o">+</span> <span class="n">rootFracLow030150</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rootFracUpp005030</span> <span class="o">/</span> <span class="p">(</span><span class="n">rootFracUpp000005</span> <span class="o">+</span> <span class="n">rootFracUpp005030</span> <span class="o">+</span> <span class="n">rootFracLow030150</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rootFracLow030150</span> <span class="o">/</span> <span class="p">(</span><span class="n">rootFracUpp000005</span> <span class="o">+</span> <span class="n">rootFracUpp005030</span> <span class="o">+</span> <span class="n">rootFracLow030150</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># if not defined, put everything in the first layer:</span>
            <span class="c1">#self.var.adjRootFrUpp000005 = pcr.cover(self.adjRootFrUpp000005,1.0)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>


            <span class="c1"># ------------------------------------------</span>
            <span class="c1"># calculateTotAvlWaterCapacityInRootZone</span>
            <span class="c1"># total water capacity in the root zone (upper soil layers)</span>
            <span class="c1"># Note: This is dependent on the land cover type.</span>

            <span class="n">h1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAtFieldCapUpp000005</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAtWiltPointUpp000005</span><span class="p">)</span> <span class="o">*</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">satVolMoistContUpp000005</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">resVolMoistContUpp000005</span><span class="p">)</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">thickUpp000005</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">maxRootDepth</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAtFieldCapUpp005030</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAtWiltPointUpp005030</span><span class="p">)</span> <span class="o">*</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">satVolMoistContUpp005030</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">resVolMoistContUpp005030</span><span class="p">)</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">thickUpp005030</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">maxRootDepth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">thickUpp000005</span><span class="p">))</span>


            <span class="n">h3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAtFieldCapLow030150</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAtWiltPointLow030150</span><span class="p">)</span> <span class="o">*</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">satVolMoistContLow030150</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">resVolMoistContLow030150</span><span class="p">)</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">thickLow030150</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">maxRootDepth</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">thickUpp005030</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totAvlWater</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">+</span> <span class="n">h2</span> <span class="o">+</span> <span class="n">h3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totAvlWater</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totAvlWater</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp000005</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp005030</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapLow030150</span><span class="p">)</span>

            <span class="c1"># --------------------------------------------------------------------------------------------------------</span>
            <span class="c1"># calculateParametersAtHalfTranspiration(self, parameters):</span>
            <span class="c1"># average soil parameters at which actual transpiration is halved</span>
            <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp000005</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">matricSuction50</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">airEntryValueUpp000005</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">poreSizeBetaUpp000005</span><span class="p">)</span>

            <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp005030</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">matricSuction50</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">airEntryValueUpp000005</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">poreSizeBetaUpp000005</span><span class="p">)</span>

            <span class="n">h3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapLow030150</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">matricSuction50</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">airEntryValueLow030150</span><span class="p">)</span> <span class="o">**</span> \
                <span class="p">(</span><span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">poreSizeBetaLow030150</span><span class="p">)</span> <span class="o">/</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp000005</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp005030</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapLow030150</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effSatAt50</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">+</span> <span class="n">h2</span> <span class="o">+</span> <span class="n">h3</span>

            <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp000005</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">poreSizeBetaUpp000005</span> <span class="o">+</span>\
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp005030</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">poreSizeBetaUpp005030</span> <span class="o">+</span>\
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapLow030150</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">poreSizeBetaLow030150</span>
            <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp000005</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp000005</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapUpp005030</span> <span class="o">*</span>\
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrUpp005030</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">storCapLow030150</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">adjRootFrLow030150</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">effPoreSizeBetaAt50</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">/</span> <span class="n">h2</span>



            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">landcoverSumSum</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;directRunoff&#39;</span><span class="p">,</span> <span class="s1">&#39;totalPotET&#39;</span><span class="p">,</span> <span class="s1">&#39;potTranspiration&#39;</span><span class="p">,</span> <span class="s2">&quot;Precipitation&quot;</span><span class="p">,</span> <span class="s1">&#39;ETRef&#39;</span><span class="p">,</span><span class="s1">&#39;gwRecharge&#39;</span><span class="p">,</span><span class="s1">&#39;Runoff&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">landcoverSumSum</span><span class="p">:</span>
            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="s2">&quot;sumsum_&quot;</span> <span class="o">+</span> <span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>



    <span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="landcoverType.dynamic_fracIrrigation"><a class="viewcode-back" href="../../hydrological_modules.html#hydrological_modules.landcoverType.landcoverType.dynamic_fracIrrigation">[docs]</a>    <span class="k">def</span> <span class="nf">dynamic_fracIrrigation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dynamic part of the land cover type module</span>
<span class="sd">            calculating fraction of land cover</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;includeIrrigation&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;dynamicIrrigationArea&#39;</span><span class="p">]:</span>
        <span class="c1"># if first day of the year or first day of run</span>


            <span class="k">if</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;newStart&#39;</span><span class="p">]</span> <span class="ow">or</span>  <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;newYear&#39;</span><span class="p">]:</span>

               <span class="c1"># updating fracVegCover of landCover (for historical irrigation areas, done at yearly basis)</span>
               <span class="c1"># read historical irrigation areas</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrigationArea</span> <span class="o">=</span> <span class="mf">10000.0</span> <span class="o">*</span><span class="n">readnetcdf2</span><span class="p">(</span><span class="n">binding</span><span class="p">[</span><span class="s1">&#39;historicalIrrigationArea&#39;</span><span class="p">],</span> <span class="n">dateVar</span><span class="p">[</span><span class="s1">&#39;currDate&#39;</span><span class="p">],</span> <span class="s2">&quot;yearly&quot;</span><span class="p">)</span>

               <span class="c1"># area of irrigation is limited by cellArea</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrigationArea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrigationArea</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrigationArea</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrigationArea</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">cellArea</span><span class="p">)</span>

               <span class="c1"># calculate fracVegCover (for irrigation only)</span>
               <span class="c1"># forest  = 0, grassland = 1, irrPaddy = 2 , irrnonpaddy = 3</span>
               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fractionArea</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrTypeFracOverIrr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">irrigationArea</span>   <span class="c1"># unit: square m</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fractionArea</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">cellArea</span><span class="p">)</span>  <span class="c1"># unit: fraction</span>
                   <span class="c1"># avoiding small numbers</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.001</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">)</span>

               <span class="n">irrigatedAreaFrac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
               <span class="n">nonirrigatedAreaFrac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
               <span class="n">totalAreafrac</span> <span class="o">=</span> <span class="n">irrigatedAreaFrac</span> <span class="o">+</span> <span class="n">nonirrigatedAreaFrac</span>
               <span class="c1"># Correction of forest and grassland by irrigation part: #have to think if irrigation should go at the same pecentage from forest</span>
               <span class="c1"># BETTER adjust these maps before !!!</span>

               <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracForestOrig</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">irrigatedAreaFrac</span><span class="p">)</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracGrasslandOrig</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span> <span class="n">irrigatedAreaFrac</span><span class="p">)</span></div>

               <span class="c1">#for i in xrange(0,2):</span>
               <span class="c1">#    self.var.fracVegCover[i] = self.var.fracVegCover[i]/totalAreafrac</span>

<span class="c1"># --------------------------------------------------------------------------</span>

<div class="viewcode-block" id="landcoverType.dynamic"><a class="viewcode-back" href="../../hydrological_modules.html#hydrological_modules.landcoverType.landcoverType.dynamic">[docs]</a>    <span class="k">def</span> <span class="nf">dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; dynamic part of the land cover type module</span>
<span class="sd">            calculating soil for each land cover class</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;calcWaterBalance&#39;</span><span class="p">]:</span>
            <span class="n">preTopWaterLayer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">preStorUpp000005</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">preStorUpp005030</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">preStorLow030150</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">preIntStor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">pretotalSoil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totalSoil</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>



        <span class="n">coverNo</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># update soil (loop per each land cover type):</span>
        <span class="k">for</span> <span class="n">coverType</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">coverTypes</span><span class="p">:</span>
            <span class="c1">#print coverNo,coverType</span>


            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">evaporation_module</span><span class="o">.</span><span class="n">dynamic</span><span class="p">(</span><span class="n">coverType</span><span class="p">,</span> <span class="n">coverNo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">interception_module</span><span class="o">.</span><span class="n">dynamic</span><span class="p">(</span><span class="n">coverType</span><span class="p">,</span> <span class="n">coverNo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">soil_module</span><span class="o">.</span><span class="n">dynamic</span><span class="p">(</span><span class="n">coverType</span><span class="p">,</span> <span class="n">coverNo</span><span class="p">)</span>
            <span class="n">coverNo</span> <span class="o">+=</span> <span class="mi">1</span>


        <span class="c1"># aggregated variables by fraction of land cover</span>
        <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">landcoverSum</span><span class="p">:</span>
            <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="s2">&quot;sum_&quot;</span> <span class="o">+</span> <span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="nb">globals</span><span class="o">.</span><span class="n">inZero</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">No</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="s2">&quot;sum_&quot;</span> <span class="o">+</span> <span class="n">variable</span><span class="p">]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">fracVegCover</span><span class="p">[</span><span class="n">No</span><span class="p">]</span> <span class="o">*</span> <span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)[</span><span class="n">variable</span><span class="p">][</span><span class="n">No</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totalSoil</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totalSto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">SnowCover</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span> <span class="o">+</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">totalET</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actTranspiTotal</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actBareSoilEvap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_openWaterEvap</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptEvap</span>


<span class="c1">###--------------------------------------------------------------------</span>
<span class="c1">### DEBUG</span>

        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;calcWaterBalance&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">waterbalance_module</span><span class="o">.</span><span class="n">waterBalanceCheck</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">Rain</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">SnowMelt</span><span class="p">],</span>  <span class="c1"># In</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_availWaterInfiltration</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptEvap</span><span class="p">],</span>  <span class="c1"># Out</span>
                <span class="p">[</span><span class="n">preIntStor</span><span class="p">],</span>   <span class="c1"># prev storage</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span><span class="p">],</span>
                <span class="s2">&quot;InterAll&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;calcWaterBalance&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">waterbalance_module</span><span class="o">.</span><span class="n">waterBalanceCheck</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_availWaterInfiltration</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_capRiseLow030150</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_irrGrossDemand</span><span class="p">],</span>                             <span class="c1"># In  self.var.irrGrossDemand</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_directRunoff</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interflowTotal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_percLow030150</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actTranspiTotal</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actBareSoilEvap</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_openWaterEvap</span><span class="p">],</span>                                                                <span class="c1"># Out</span>
                <span class="p">[</span><span class="n">preTopWaterLayer</span><span class="p">,</span><span class="n">preStorUpp000005</span><span class="p">,</span><span class="n">preStorUpp005030</span><span class="p">,</span><span class="n">preStorLow030150</span><span class="p">],</span>                                       <span class="c1"># prev storage</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span><span class="p">],</span>
                <span class="s2">&quot;Soil_sum&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;calcWaterBalance&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">waterbalance_module</span><span class="o">.</span><span class="n">waterBalanceCheck</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">Rain</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">SnowMelt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_capRiseLow030150</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_irrGrossDemand</span><span class="p">],</span>                             <span class="c1"># In  self.var.irrGrossDemand</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_directRunoff</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interflowTotal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_percLow030150</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actTranspiTotal</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actBareSoilEvap</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_openWaterEvap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptEvap</span><span class="p">],</span>                                                                <span class="c1"># Out</span>
                <span class="p">[</span><span class="n">preTopWaterLayer</span><span class="p">,</span><span class="n">preStorUpp000005</span><span class="p">,</span><span class="n">preStorUpp005030</span><span class="p">,</span><span class="n">preStorLow030150</span><span class="p">,</span><span class="n">preIntStor</span><span class="p">],</span>                                       <span class="c1"># prev storage</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span><span class="p">],</span>
                <span class="s2">&quot;Soil_sum&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;calcWaterBalance&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">waterbalance_module</span><span class="o">.</span><span class="n">waterBalanceCheck</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">Precipitation</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_capRiseLow030150</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_irrGrossDemand</span><span class="p">],</span>                             <span class="c1"># In</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_directRunoff</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interflowTotal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_percLow030150</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actTranspiTotal</span><span class="p">,</span> \
                 <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_actBareSoilEvap</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_openWaterEvap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptEvap</span><span class="p">],</span>                                                                <span class="c1"># Out</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">prevSnowCover</span><span class="p">,</span> <span class="n">preTopWaterLayer</span><span class="p">,</span><span class="n">preStorUpp000005</span><span class="p">,</span><span class="n">preStorUpp005030</span><span class="p">,</span><span class="n">preStorLow030150</span><span class="p">,</span><span class="n">preIntStor</span><span class="p">],</span>                                       <span class="c1"># prev storage</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">SnowCover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_topWaterLayer</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp000005</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storUpp005030</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_storLow030150</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="o">.</span><span class="n">sum_interceptStor</span><span class="p">],</span>
                <span class="s2">&quot;Soil_All&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>




        <span class="c1">#a = decompress(self.var.sumsum_Precipitation)</span>
        <span class="c1">#b = cellvalue(a,81,379)</span>
        <span class="c1">#print self.var.sum_directRunoff</span>
        <span class="c1">#report(decompress(self.var.sumsum_Precipitation), &quot;c:\work\output\Prsum.map&quot;)</span>
        <span class="c1">#report(decompress(self.var.sumsum_gwRecharge), &quot;c:\work\output\gwrsum.map&quot;)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        # landcover UpdateLC 370</span>
<span class="sd">        getPotET(coverType,coverNo)</span>
<span class="sd">        self.interceptionUpdate(meteo, currTimeStep)  # calculate interception and update storage</span>
<span class="sd">            # snow already calculated</span>

<span class="sd">        # calculate qDR &amp; qSF &amp; q23 (and update storages)</span>
<span class="sd">        self.upperSoilUpdate(meteo,groundwater,routing, parameters,capRiseFrac, nonIrrGrossDemand,swAbstractionFraction 378 -&gt; 1642</span>
<span class="sd">            self.getSoilStates(parameters) 1656 -&gt; 626</span>
<span class="sd">            self.calculateWaterDemand  777</span>
<span class="sd">            self.calculateOpenWaterEvap() 1027</span>
<span class="sd">            self.calculateDirectRunoff(parameters)   940</span>
<span class="sd">            self.calculateInfiltration(parameters)  1052</span>
<span class="sd">            self.estimateTranspirationAndBareSoilEvap(parameters)</span>
<span class="sd">            self.estimateSoilFluxes(parameters,capRiseFrac)</span>
<span class="sd">            self.scaleAllFluxes(parameters, groundwater)</span>
<span class="sd">            self.updateSoilStates(parameters)</span>

<span class="sd">        &quot;&quot;&quot;</span></div></div>



</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/CWATM.jpg" alt="Logo"/>
            </a></p>
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nexus.html">2. Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community.html">3. Features of the Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../settings.html">4. Running the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">5. Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../results.html">6. Demo of the model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo.html">7. TODO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../source.html">8. <strong>Source code</strong></a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">CWATM</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, PB.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.6.
    </div>
  </body>
</html>